<title>can.List.filter()</title>

<div id="demo"></div>

<script id="main-template" type="text/stache">
<p>FPS: {{stats.fps}}</p>
<table>
    {{#each lists}}
        <tr>
            <td>{{label}}:</td>
            <td class="circles">
                {{#each numbers}}
                    <div class="circle" style="background-color: {{hex}}">{{number}}</div>
                {{/each}}
            </td>
        </tr>
    {{/each}}
</table>
</script>

<script src="../../node_modules/steal/steal.js"></script>
<script src="./random-color.js"></script>
<script type="text/javascript">
steal('can', 'can/view/stache', 'list', function () {
    var NUMBER_OF_DICE = 540;
    var DO_UPDATE = true;  // change to false to see fps without update

    var numbers = new can.List();
    var stats = new can.Map({ fps: 0 });
    var generateRandomNumber = function () { return Math.ceil(Math.random() * 99); }
    var lastTick = 0;
    var frames = 0;
    var msecs = 0;

    for (var i = 0; i < NUMBER_OF_DICE; i++) {
        var hex = randomColor({
           luminosity: 'dark',
           hue: 'random'
        });

        numbers.push({
            hex: hex,
            number: generateRandomNumber()
        });
    }

    requestAnimationFrame(frame);

    function frame() {
      var now = performance.now();
      msecs += (now - lastTick);
      lastTick = now;

      if (msecs >= 1000) {
        stats.attr('fps', Math.round(frames / (msecs / 1000)));
        frames = msecs = 0;
      }

      if (DO_UPDATE) update();
      i++;
      frames++;
      requestAnimationFrame(frame);
    }

    function update() {
      if (i >= NUMBER_OF_DICE) {
          i = 0;
      }
      numbers.attr(i).attr('number', generateRandomNumber());
    }

    $('#demo').append(can.view('main-template', {
      stats: stats,
      lists: [
        {
            label: 'Source',
            numbers: numbers
        },
        {
            label: 'Even',
            numbers: numbers.filter(function (number) {
                return number.attr('number') % 2 === 0;
            })
        },
        {
            label: 'Odd',
            numbers: numbers.filter(function (number) {
                return number.attr('number') % 2 !== 0;
            })
        },
        {
            label: '< 50',
            numbers: numbers.filter(function (number) {
                return number.attr('number') <= 50;
            })
        },
        {
            label: '> 50',
            numbers: numbers.filter(function (number) {
                return number.attr('number') >= 50;
            })
        }
    ]}));

});
</script>

<style type="text/css">
html {
    font-family: sans-serif;
    font-size: 12px;
}
table, tbody, th, tr, td {
    border-spacing: 0;
    border-collapse: collapse;
    font-size: 1em;
}
td {
    vertical-align: top;
    line-height: 30px;
}

td:first-child {
    width: 50px;
    font-weight: bold;
}
td:last-child {
    padding-bottom: 10px;
}
.circle {
    float: left;
    width: 30px;
    height: 30px;
    margin: 0 2px 1px;
    text-align: center;
    line-height: 30px;
    border-radius: 50%;
    color: #fff;
    background-color: #eee;
}
</style>
